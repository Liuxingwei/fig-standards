扩展编码风格指南元文档
=========================================

# 1. 概述

本文档描述了引出扩展编码风格规范的过程和讨论。其目的是解释每个决定背后的原因。

# 2. 何必这样？

PSR-2 是 2012 年被接受的，那以后 PHP 有了很多对编码风格的指导有影响的变动，最显著的是 PHP 7 的变动。
在编写 PS$-2 的时候，对 PHP 已有功能的覆盖是很全面的，对新功能的解释则很开放。PSR-12 试图提供一组编码
风格工具能实现的，项目声明遵守，程序员能轻易地将不同项目关联起来的编码风格，以降低认知分歧。

PSR-2 是基于目前的 PHP-FIG 项目实践创建的，但这也意味着它是不同项目指导原则的折衷。修改编码指导原则以与
PSR-2 保持一致（几乎所有项目都与 PSR-1 保持一致，即使它没有明确说明）被认为影响过大（丢失历史、庞大的变
更集、破坏现在的更新/推送请求）。

PSR-2 让采用该规范的用户格式化大量的已有代码的要求阻碍了其被更广泛地采用。为帮助 PSR-12 缓解此问题，我们
采用了更规范的方法，并在新的语言特性发布时定义了相关标准。

不过，我们的目标是在 PSR-12 中应用 PSR-2 的风格、原理和立场（见第四小节「方法」），而不是武断地建立新规约。

# 3. 范围

## 3.1. 目标

本规范的目标与 PSR-2 相同。

>本指南的目的是减少不同用户浏览代码时的认知分歧。这是通过列举一组有关如何格式化 PHP 代码的共享规则来实现的。
>
>本文中的风格规则来自于各个成员项目之间的共性。当不同的作者跨多个项目协作，在所有这些项目中使用一套指导原则
>是有帮助的。因此，本指南的好处不在于规则本身，而在于共享这些规则.

本规范是 PSR-2 的扩展，自然也是 PSR-1 的扩展。PSR-12 的基础是 PSR-2，所以下面提供了差异列表来为从 PSR-2
迁移提供帮助，但 PSR-12 应被视作独立的规范。

本规范将包含与 PSR-2 规范发布之后添加到 PHP（包括PHP 5.5、PHP 5.6、PHP 7）的新特性相关的编码风格指导原
则。如 PSR-2 勘误表所述，本规范还包含对 PSR-2 文本的澄清。

## 3.2. 目标之外

本规范的目标不是添加全新的编码风格指南，它也不改变 PSR-1 和 PSR-2 的任何约定。

# 4. 方法

总的原则是尝试在新功能上应用已有的 PSR-2 风格和基本原则，而不是建立新规约。

## 4.1. 严格类型声明

https://github.com/cs-extended/fig-standards/issues/7 上有关于是否应该强制执行严格类型声明的讨论。
所有人都同意应该只使用**必须**或**不得**字样，避免使用**应该**字样，没有人想说不能声明严格类型。该讨论针对
的是它是否应被视为编码风格样式应该覆盖的部分，还是已经超出了范围。最终认定它已经超出了编码风格指南的范围。

## 4.2. Finally 和 Return 类型声明的留白

能在[返回类型声明](https://gist.github.com/michaelcullum/c025f3870c9ea1dd2668#file-returntypesspacing-php)
或[ Finally 块](https://gist.github.com/michaelcullum/c025f3870c9ea1dd2668#file-finallyblocks-php)
找到许多不同的推荐选项，当前的实现是来自 PSR-2 的与 PSR-12 的其它部分一致的选择。

## 4.3. 强制所有类型关键字使用短格式

PHP 7.0 引入不支持长类型别名的[ 标量类型声明 ](http://php.net/manual/zh/functions.arguments.php#functions.arguments.type-declaration)。
因此强制使用主要的短类型格式以获得统一的语法，并防止可能的混淆是有意义的。

## 4.4. 民意调查

为借助数据解决问题而进行的调查，收集到了142个人（包括17名项目代表）的回复：

### 4.4.1. PHP-FIG 代表的反馈结果

| 代表          | 项目           | **不得**使用深度为两个或更多个的复合命名空间 | Header 语句分组和排序 | Declare 语句必须单一且独占一行 | PHP 文件中的 Declare 语句包含标记 | Declare 语句没有空格： `declare(strict_types=1);` | 声明语句块格式化 | 使用关键词 `new` 必须带括号 | 返回类型定义格式化 | Use 语句不允许斜杠开头 | 命名空间声明块格式化 | 常规运算符留白 | Try, Catch, Finally 格式化 | 匿名类声明格式化 | 关键词小写 | 仅使用类型关键词的短形式 |
| --------------          | -------           | ---------------------------------------------------- | ---------------------------------- | ----------------------------------------- | ------------------------------------------- | -------------------------------------------------------- | ------------------------------- | ------------------------------------- |------------------------------- |------------------------------------ | ----------------------------------- | ---------------------- |--------------------------- | ----------------------------------- | --------------------------- | -------------------------- |
| Alexander Makarov       | Yii framework    | ✓ | ✓ | ✓ | ❌ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| Korvin Szanto           | concrete5         | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| Leo Feyer               | Contao            | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| Larry Garfield          | Drupal            | ✓ | ✓ | ✓ | ✓ | ✓ | ❌ | ✓ | ✓ | ✓ | ❌ | ✓ | ✓ | ❌ | ✓ | ✓ |
| André R.                | eZ                | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| Jan Schneider           | Horde             | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| Karsten Dambekalns      | Neos and Flow     | ✓ | ✓ | ✓ | ✓ | ❌ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| Andres Gutierrez        | Phalcon           | ❌ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| Ryan Thompson           | PyroCMS           | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ❌ | ❌ | ✓ | ✓ | ✓ | ✓ | ✓ |
| Matteo Beccati          | Revive Adserver   | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ❌ | ✓ | ✓ | ✓ | ✓ |
| Damian Mooyman          | SilverStripe      | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| Brian Retterer          | Stormpath PHP SDK | ✓ | ✓ | ✓ | ❌ | ❌ | ✓ | ❌ | ✓ | ❌ | ✓ | ✓ | ✓ | ✓ | ❌ | ❌ |
| Matthew Weier O'Phinney | Zend Framework    | ❌ | ✓ | ✓ | ❌ | ✓ | ✓ | ✓ | ❌ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| Jordi Boggiano          | Composer          | ❌ | ❌ | ❌ | ✓ | ✓ | ✓ | ❌ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| Ben Marks               | Magento           | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| Chuck Burgess           | PEAR              | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
|                         | **汇总**:       |13/3|15/1|15/1|13/3|14/2|15/1|14/2|15/1|14/2|14/2|15/1|16/0|15/1|15/1|15/1|

### 4.4.2. 一般非代表受访者

| 问题 | 同意 | 反对 | 赞成百分比 |
| -------- | --- | ------- | -------------- |
| 复合命名空间所需深度 | 114 | 12 | 89.47% |
| Header 语句分组和排序 | 113 | 13 | 88.5% |
| Declare 语句必须单一且独占一行 | 120 | 6 | 95% |
| PHP 文件中的 Declare 语句包含标记 | 119 | 7 | 94.12% |
| Declare 语句没有空格 | 116 | 10 | 91.38% |
| Declare 语句块格式化 | 118 | 8 | 93.22% |
| 使用关键词 `new` 必须带括号 | 116 | 10 | 91.38% |
| 返回类型定义格式化 | 115 | 11 | 90.43% |
| Use 语句不允许斜杠开头 | 118 | 8 | 93.22% |
| 命名空间声明块格式化 | 120 | 6 | 95% |
| 常规运算符留白 | 123 | 3 | 97.56% |
| Try, Catch, Finally 格式化 | 124 | 2 | 98.39% |
| 匿名类声明格式化 | 117 | 9 | 92.31% |
| 关键词小写 | 124 | 2 | 98.39% |
| 仅使用类型关键词的短形式 | 121 | 5 | 95.87% |

## 4.5. 函数参数多行和返回值多行的混合

[邮件列表](https://groups.google.com/d/msg/php-fig/ULSL4gqK8GY/cgDELuPOCQAJ)提出了一个潜在的可读性问题。
我们重新审视了那些能够提供更好可读性的规范变更，未定的选项是如果参数和返回值均为多行，则函数的左括号后需要一个空行。
有人指出规范 _已经_ 允许你决定如何添加空行，所以我们把它留给实现者自行决断。

# 5. 自 PSR-2 之后的变更日志

请注意，此变更日志不是自 PSR-2 之后的详细变化列表，但突出显示了最显著的变化。它应该被视为新的规范，你应该阅读该规范并完全领会其内容。

## 5.1. 新术语

* 全部关键词小写 - 2.5节
* 类型关键词短格式 - 2.5节
* Use 语句分组 - 第3节
* Use 语句块 - 第3节
* Declare 语句/Strict 类型声明用法 - 第3节
* 类实例化总是带有括号 - 第4节
* 类型属性 - 4.3节
* 返回类型声明 - 4.5节
* 变量和引用参数运算符 - 4.5节
* 类型提示 - 4.5节
* 添加 finally 块- 5.6节
* 运算符 - 第6节
* 一元运算符 - 6.1节
* 二元运算符 - 6.2节
* 三元运算符 - 6.3节
* 匿名类 - 第8节

## 5.2. 澄清和勘误

* 将'方法'调整为'方法和函数' - 通篇
* 类和接口引用调整为包括 traits - 通篇
* StudlyCaps 指的就是 PascalCase - 2.1节
* 最后一行不应为空，但应包含行结束符 - 2.2节
* 除 PSR 明确禁止的情况外，可以添加空行以提高可读性 - 2.3节
* PSR-2 关于多行参数的勘误 - 第4节
* PSR-2 关于扩展多个接口的勘误 - 第4节
* 类的右大花括号之前/左大花括号之后禁止有空行 - 第4节

# 6. 人员

## 6.1.  编辑:
* Korvin Szanto

## 6.2. 担保人:

* Chris Tankersley

## 6.3. 工作组成员：

* Alessandro Lai
* Alexander Makarov
* Michael Cullum
* Robert Deutz

## 6.4. 特别感谢

* Michael Cullum 起草了原始规范
* Alexandar Makarov 协调 PHP-FIG 2.0 草稿
* Cees-Jan Kiewiet 提供精神支持

# 7. 投票

* **Entrance Vote:** https://groups.google.com/forum/?utm_medium=email&utm_source=footer#!msg/php-fig/P9atZLOcUBM/_jwkvlYKEAAJ
* **Approval Vote:** https://groups.google.com/forum/#!topic/php-fig/1uaeSMaDGbk

# 8. 相关链接

_**注意：**_ 按时间倒序排列

* [灵感来源邮件列表线程](https://groups.google.com/forum/?utm_medium=email&utm_source=footer#!topic/php-fig/wh9avopSR9k)
* [初始邮件列表 PSR 建议线程](https://groups.google.com/forum/?utm_medium=email&utm_source=footer#!topic/php-fig/MkFacLdfGso)
